{"ast":null,"code":"var _jsxFileName = \"D:\\\\Airticket\\\\frontend\\\\src\\\\components\\\\PaymentForm.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Elements, CardElement, useStripe, useElements } from '@stripe/react-stripe-js';\nimport './Payment.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY || 'pk_test_your_publishable_key_here');\n\n// Payment Method Selection Component\nconst PaymentMethodSelector = ({\n  selectedMethod,\n  onMethodChange,\n  walletBalance,\n  amount\n}) => {\n  const paymentMethods = [{\n    id: 'stripe',\n    name: 'Thẻ tín dụng',\n    icon: '💳',\n    description: 'Thanh toán bằng thẻ Visa, MasterCard',\n    available: true\n  }, {\n    id: 'wallet',\n    name: 'Ví điện tử',\n    icon: '👛',\n    description: `Số dư: ${new Intl.NumberFormat('vi-VN', {\n      style: 'currency',\n      currency: 'VND'\n    }).format(walletBalance)}`,\n    available: walletBalance >= amount,\n    disabled: walletBalance < amount\n  }];\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"payment-methods\",\n    children: paymentMethods.map(method => /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `payment-method-card ${selectedMethod === method.id ? 'selected' : ''} ${!method.available ? 'disabled' : ''}`,\n      onClick: () => method.available && onMethodChange(method.id),\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"method-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"method-icon\",\n          children: method.icon\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 37,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"method-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"method-name\",\n            children: method.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 39,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"method-description\",\n            children: method.description\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 40,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 38,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"method-radio\",\n          children: /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"radio\",\n            checked: selectedMethod === method.id,\n            onChange: () => method.available && onMethodChange(method.id),\n            disabled: !method.available\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 43,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 42,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 36,\n        columnNumber: 11\n      }, this), !method.available && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"method-error\",\n        children: method.id === 'wallet' ? 'Số dư không đủ' : 'Phương thức không khả dụng'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 52,\n        columnNumber: 13\n      }, this)]\n    }, method.id, true, {\n      fileName: _jsxFileName,\n      lineNumber: 31,\n      columnNumber: 9\n    }, this))\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 29,\n    columnNumber: 5\n  }, this);\n};\n\n// Stripe Payment Form\n_c = PaymentMethodSelector;\nconst StripePaymentForm = ({\n  amount,\n  currency,\n  ticketId,\n  onPaymentSuccess,\n  onPaymentError\n}) => {\n  _s();\n  const stripe = useStripe();\n  const elements = useElements();\n  const [loading, setLoading] = useState(false);\n  const [clientSecret, setClientSecret] = useState('');\n  const [error, setError] = useState('');\n\n  // Các state cho form fake\n  const [name, setName] = useState('');\n  const [cardNumber, setCardNumber] = useState('');\n  const [expiry, setExpiry] = useState('');\n  const [cvc, setCvc] = useState('');\n  useEffect(() => {\n    const createPaymentIntent = async () => {\n      try {\n        const token = localStorage.getItem('accessToken');\n        if (!token) {\n          setError('Không tìm thấy token xác thực');\n          return;\n        }\n        const response = await fetch('http://localhost:8080/api/v1/payments/create-payment-intent', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${token}`\n          },\n          body: JSON.stringify({\n            ticketId,\n            amount,\n            currency,\n            paymentMethod: 'stripe'\n          })\n        });\n        if (response.ok) {\n          var _data$data, _data$data2;\n          const data = await response.json();\n          setClientSecret(((_data$data = data.data) === null || _data$data === void 0 ? void 0 : _data$data.clientSecret) || '');\n          if (!((_data$data2 = data.data) !== null && _data$data2 !== void 0 && _data$data2.clientSecret)) setError('Không nhận được client secret từ server');\n        } else {\n          const err = await response.json();\n          setError(err.message || 'Không thể tạo payment intent');\n        }\n      } catch (err) {\n        console.error(err);\n        setError('Lỗi kết nối server');\n      }\n    };\n    if (ticketId && amount > 0) createPaymentIntent();\n  }, [ticketId, amount, currency]);\n  const handleSubmit = async event => {\n    event.preventDefault();\n    if (!stripe || !elements) return setError('Stripe chưa được khởi tạo');\n    if (!clientSecret) return setError('Chưa nhận được client secret');\n    setLoading(true);\n    setError('');\n    try {\n      const cardElement = elements.getElement(CardElement);\n      if (!cardElement) return setError('Không tìm thấy form thẻ');\n      const {\n        error: stripeError,\n        paymentIntent\n      } = await stripe.confirmCardPayment(clientSecret, {\n        payment_method: {\n          card: cardElement,\n          billing_details: {\n            name: name || 'Khách hàng'\n          }\n        }\n      });\n      if (stripeError) setError(stripeError.message || 'Thanh toán thất bại');else if (paymentIntent.status === 'succeeded') {\n        const token = localStorage.getItem('accessToken');\n        const confirmResponse = await fetch('http://localhost:8080/api/v1/payments/confirm-payment', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${token}`\n          },\n          body: JSON.stringify({\n            paymentIntentId: paymentIntent.id\n          })\n        });\n        if (confirmResponse.ok) onPaymentSuccess(paymentIntent.id);else {\n          const errData = await confirmResponse.json();\n          setError(errData.message || 'Không thể xác nhận thanh toán');\n        }\n      } else setError('Thanh toán không thành công');\n    } catch (err) {\n      console.error(err);\n      setError('Lỗi xử lý thanh toán');\n    }\n    setLoading(false);\n  };\n  const cardStyle = {\n    style: {\n      base: {\n        fontSize: '16px',\n        color: '#424770',\n        '::placeholder': {\n          color: '#aab7c4'\n        }\n      },\n      invalid: {\n        color: '#fa755a',\n        iconColor: '#fa755a'\n      }\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"payment-form\",\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      children: [\"T\\u1ED5ng ti\\u1EC1n: \", new Intl.NumberFormat('vi-VN', {\n        style: 'currency',\n        currency\n      }).format(amount)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Thanh to\\xE1n an to\\xE0n v\\u1EDBi Stripe\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 7\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error-message\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-group\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"T\\xEAn ch\\u1EE7 th\\u1EBB\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"NGUYEN VAN A\",\n          value: name,\n          onChange: e => setName(e.target.value),\n          required: true,\n          disabled: loading\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-group-inline\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"S\\u1ED1 th\\u1EBB 1234 5678 9012 3456\",\n          value: cardNumber,\n          onChange: e => setCardNumber(e.target.value),\n          disabled: loading\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"MM/YY\",\n          value: expiry,\n          onChange: e => setExpiry(e.target.value),\n          disabled: loading\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"CVC\",\n          value: cvc,\n          onChange: e => setCvc(e.target.value),\n          disabled: loading\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-group\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Th\\xF4ng tin th\\u1EBB\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"card-element-container\",\n          children: stripe && elements ? /*#__PURE__*/_jsxDEV(CardElement, {\n            options: cardStyle\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 213,\n            columnNumber: 35\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            children: \"\\u0110ang t\\u1EA3i...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 213,\n            columnNumber: 73\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        disabled: !stripe || !clientSecret || loading,\n        children: loading ? 'Đang xử lý...' : `Thanh toán ${new Intl.NumberFormat('vi-VN', {\n          style: 'currency',\n          currency\n        }).format(amount)}`\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"\\uD83D\\uDD12 Thanh to\\xE1n \\u0111\\u01B0\\u1EE3c b\\u1EA3o m\\u1EADt b\\u1EDFi Stripe. Th\\xF4ng tin th\\u1EBB \\u0111\\u01B0\\u1EE3c m\\xE3 h\\xF3a v\\xE0 b\\u1EA3o v\\u1EC7.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 164,\n    columnNumber: 5\n  }, this);\n};\n\n// Wallet Payment Form\n_s(StripePaymentForm, \"YS//ZTQulgFEuMOVyrbIL7VpK4A=\", false, function () {\n  return [useStripe, useElements];\n});\n_c2 = StripePaymentForm;\nconst WalletPaymentForm = ({\n  amount,\n  ticketId,\n  onPaymentSuccess,\n  onPaymentError\n}) => {\n  _s2();\n  const [loading, setLoading] = useState(false);\n  const [pin, setPin] = useState('');\n  const [error, setError] = useState('');\n  const [requiresPin, setRequiresPin] = useState(false);\n  const handleSubmit = async event => {\n    event.preventDefault();\n    setLoading(true);\n    setError('');\n    try {\n      const token = localStorage.getItem('accessToken');\n      const response = await fetch('http://localhost:8080/api/v1/payments/create-payment-intent', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          ticketId,\n          amount,\n          currency: 'vnd',\n          paymentMethod: 'wallet',\n          pin: pin\n        })\n      });\n      if (response.ok) {\n        var _data$data3;\n        const data = await response.json();\n        onPaymentSuccess(((_data$data3 = data.data) === null || _data$data3 === void 0 ? void 0 : _data$data3.transactionId) || 'wallet-payment');\n      } else {\n        const errorData = await response.json();\n        if (errorData.statusCode === 400 && errorData.message.includes('PIN')) {\n          setRequiresPin(true);\n          setError(errorData.message);\n        } else {\n          setError(errorData.message || 'Thanh toán thất bại');\n        }\n      }\n    } catch (err) {\n      console.error(err);\n      setError('Lỗi kết nối server');\n    }\n    setLoading(false);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"payment-form wallet-payment\",\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      children: [\"T\\u1ED5ng ti\\u1EC1n: \", new Intl.NumberFormat('vi-VN', {\n        style: 'currency',\n        currency: 'VND'\n      }).format(amount)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 280,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"\\uD83D\\uDCA1 Thanh to\\xE1n nhanh ch\\xF3ng b\\u1EB1ng v\\xED \\u0111i\\u1EC7n t\\u1EED\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 281,\n      columnNumber: 7\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error-message\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      children: [requiresPin && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-group\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Nh\\u1EADp m\\xE3 PIN v\\xED \\u0111i\\u1EC7n t\\u1EED\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 288,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"password\",\n          placeholder: \"1234\",\n          value: pin,\n          onChange: e => setPin(e.target.value.replace(/[^0-9]/g, '').slice(0, 6)),\n          maxLength: 6,\n          required: true,\n          disabled: loading\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 289,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 287,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        disabled: loading,\n        children: loading ? 'Đang xử lý...' : `💰 Thanh toán ${new Intl.NumberFormat('vi-VN', {\n          style: 'currency',\n          currency: 'VND'\n        }).format(amount)}`\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 301,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 285,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"\\u26A1 Thanh to\\xE1n ngay l\\u1EADp t\\u1EE9c v\\u1EDBi v\\xED \\u0111i\\u1EC7n t\\u1EED c\\u1EE7a b\\u1EA1n\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 279,\n    columnNumber: 5\n  }, this);\n};\n\n// Main Payment Form Component\n_s2(WalletPaymentForm, \"Hchyxvfv3RBFitZHvaJIgr4nMSg=\");\n_c3 = WalletPaymentForm;\nconst PaymentForm = ({\n  amount,\n  currency,\n  ticketId,\n  onPaymentSuccess,\n  onPaymentError\n}) => {\n  _s3();\n  const [selectedMethod, setSelectedMethod] = useState('stripe');\n  const [walletBalance, setWalletBalance] = useState(0);\n  useEffect(() => {\n    // Lấy thông tin ví điện tử\n    const fetchWalletInfo = async () => {\n      try {\n        const token = localStorage.getItem('accessToken');\n        const response = await fetch('http://localhost:8080/api/v1/wallet/balance', {\n          headers: {\n            'Authorization': `Bearer ${token}`,\n            'Content-Type': 'application/json'\n          }\n        });\n        if (response.ok) {\n          var _data$data4, _data$data5;\n          const data = await response.json();\n          setWalletBalance(((_data$data4 = data.data) === null || _data$data4 === void 0 ? void 0 : _data$data4.walletBalance) || 0);\n\n          // Tự động chọn ví nếu có đủ số dư\n          if (((_data$data5 = data.data) === null || _data$data5 === void 0 ? void 0 : _data$data5.walletBalance) >= amount) {\n            setSelectedMethod('wallet');\n          }\n        }\n      } catch (error) {\n        console.error('Lỗi lấy thông tin ví:', error);\n      }\n    };\n    fetchWalletInfo();\n  }, [amount]);\n  const renderPaymentForm = () => {\n    switch (selectedMethod) {\n      case 'wallet':\n        return /*#__PURE__*/_jsxDEV(WalletPaymentForm, {\n          amount: amount,\n          ticketId: ticketId,\n          onPaymentSuccess: onPaymentSuccess,\n          onPaymentError: onPaymentError\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 349,\n          columnNumber: 11\n        }, this);\n      case 'stripe':\n      default:\n        return /*#__PURE__*/_jsxDEV(Elements, {\n          stripe: stripePromise,\n          children: /*#__PURE__*/_jsxDEV(StripePaymentForm, {\n            amount: amount,\n            currency: currency,\n            ticketId: ticketId,\n            onPaymentSuccess: onPaymentSuccess,\n            onPaymentError: onPaymentError\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 360,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 359,\n          columnNumber: 11\n        }, this);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"payment-form-container\",\n    children: [/*#__PURE__*/_jsxDEV(PaymentMethodSelector, {\n      selectedMethod: selectedMethod,\n      onMethodChange: setSelectedMethod,\n      walletBalance: walletBalance,\n      amount: amount\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 374,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"payment-form-wrapper\",\n      children: renderPaymentForm()\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 381,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 373,\n    columnNumber: 5\n  }, this);\n};\n_s3(PaymentForm, \"XcS7qcGaK5fKI0BiSarM4EGCTPY=\");\n_c4 = PaymentForm;\nexport default PaymentForm;\nvar _c, _c2, _c3, _c4;\n$RefreshReg$(_c, \"PaymentMethodSelector\");\n$RefreshReg$(_c2, \"StripePaymentForm\");\n$RefreshReg$(_c3, \"WalletPaymentForm\");\n$RefreshReg$(_c4, \"PaymentForm\");","map":{"version":3,"names":["React","useState","useEffect","loadStripe","Elements","CardElement","useStripe","useElements","jsxDEV","_jsxDEV","stripePromise","process","env","REACT_APP_STRIPE_PUBLISHABLE_KEY","PaymentMethodSelector","selectedMethod","onMethodChange","walletBalance","amount","paymentMethods","id","name","icon","description","available","Intl","NumberFormat","style","currency","format","disabled","className","children","map","method","onClick","fileName","_jsxFileName","lineNumber","columnNumber","type","checked","onChange","_c","StripePaymentForm","ticketId","onPaymentSuccess","onPaymentError","_s","stripe","elements","loading","setLoading","clientSecret","setClientSecret","error","setError","setName","cardNumber","setCardNumber","expiry","setExpiry","cvc","setCvc","createPaymentIntent","token","localStorage","getItem","response","fetch","headers","body","JSON","stringify","paymentMethod","ok","_data$data","_data$data2","data","json","err","message","console","handleSubmit","event","preventDefault","cardElement","getElement","stripeError","paymentIntent","confirmCardPayment","payment_method","card","billing_details","status","confirmResponse","paymentIntentId","errData","cardStyle","base","fontSize","color","invalid","iconColor","onSubmit","placeholder","value","e","target","required","options","_c2","WalletPaymentForm","_s2","pin","setPin","requiresPin","setRequiresPin","_data$data3","transactionId","errorData","statusCode","includes","replace","slice","maxLength","_c3","PaymentForm","_s3","setSelectedMethod","setWalletBalance","fetchWalletInfo","_data$data4","_data$data5","renderPaymentForm","_c4","$RefreshReg$"],"sources":["D:/Airticket/frontend/src/components/PaymentForm.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Elements, CardElement, useStripe, useElements } from '@stripe/react-stripe-js';\nimport './Payment.css';\n\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY || 'pk_test_your_publishable_key_here');\n\n// Payment Method Selection Component\nconst PaymentMethodSelector = ({ selectedMethod, onMethodChange, walletBalance, amount }) => {\n  const paymentMethods = [\n    {\n      id: 'stripe',\n      name: 'Thẻ tín dụng',\n      icon: '💳',\n      description: 'Thanh toán bằng thẻ Visa, MasterCard',\n      available: true\n    },\n    {\n      id: 'wallet',\n      name: 'Ví điện tử',\n      icon: '👛',\n      description: `Số dư: ${new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(walletBalance)}`,\n      available: walletBalance >= amount,\n      disabled: walletBalance < amount\n    }\n  ];\n\n  return (\n    <div className=\"payment-methods\">\n      {paymentMethods.map((method) => (\n        <div\n          key={method.id}\n          className={`payment-method-card ${selectedMethod === method.id ? 'selected' : ''} ${!method.available ? 'disabled' : ''}`}\n          onClick={() => method.available && onMethodChange(method.id)}\n        >\n          <div className=\"method-header\">\n            <div className=\"method-icon\">{method.icon}</div>\n            <div className=\"method-info\">\n              <div className=\"method-name\">{method.name}</div>\n              <div className=\"method-description\">{method.description}</div>\n            </div>\n            <div className=\"method-radio\">\n              <input\n                type=\"radio\"\n                checked={selectedMethod === method.id}\n                onChange={() => method.available && onMethodChange(method.id)}\n                disabled={!method.available}\n              />\n            </div>\n          </div>\n          {!method.available && (\n            <div className=\"method-error\">\n              {method.id === 'wallet' ? 'Số dư không đủ' : 'Phương thức không khả dụng'}\n            </div>\n          )}\n        </div>\n      ))}\n    </div>\n  );\n};\n\n// Stripe Payment Form\nconst StripePaymentForm = ({ amount, currency, ticketId, onPaymentSuccess, onPaymentError }) => {\n  const stripe = useStripe();\n  const elements = useElements();\n\n  const [loading, setLoading] = useState(false);\n  const [clientSecret, setClientSecret] = useState('');\n  const [error, setError] = useState('');\n\n  // Các state cho form fake\n  const [name, setName] = useState('');\n  const [cardNumber, setCardNumber] = useState('');\n  const [expiry, setExpiry] = useState('');\n  const [cvc, setCvc] = useState('');\n\n  useEffect(() => {\n    const createPaymentIntent = async () => {\n      try {\n        const token = localStorage.getItem('accessToken');\n        if (!token) {\n          setError('Không tìm thấy token xác thực');\n          return;\n        }\n\n        const response = await fetch('http://localhost:8080/api/v1/payments/create-payment-intent', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${token}`,\n          },\n          body: JSON.stringify({ ticketId, amount, currency, paymentMethod: 'stripe' }),\n        });\n\n        if (response.ok) {\n          const data = await response.json();\n          setClientSecret(data.data?.clientSecret || '');\n          if (!data.data?.clientSecret) setError('Không nhận được client secret từ server');\n        } else {\n          const err = await response.json();\n          setError(err.message || 'Không thể tạo payment intent');\n        }\n      } catch (err) {\n        console.error(err);\n        setError('Lỗi kết nối server');\n      }\n    };\n\n    if (ticketId && amount > 0) createPaymentIntent();\n  }, [ticketId, amount, currency]);\n\n  const handleSubmit = async (event) => {\n    event.preventDefault();\n    if (!stripe || !elements) return setError('Stripe chưa được khởi tạo');\n    if (!clientSecret) return setError('Chưa nhận được client secret');\n\n    setLoading(true);\n    setError('');\n\n    try {\n      const cardElement = elements.getElement(CardElement);\n      if (!cardElement) return setError('Không tìm thấy form thẻ');\n\n      const { error: stripeError, paymentIntent } = await stripe.confirmCardPayment(clientSecret, {\n        payment_method: {\n          card: cardElement,\n          billing_details: { name: name || 'Khách hàng' },\n        },\n      });\n\n      if (stripeError) setError(stripeError.message || 'Thanh toán thất bại');\n      else if (paymentIntent.status === 'succeeded') {\n        const token = localStorage.getItem('accessToken');\n        const confirmResponse = await fetch('http://localhost:8080/api/v1/payments/confirm-payment', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${token}`,\n          },\n          body: JSON.stringify({ paymentIntentId: paymentIntent.id }),\n        });\n\n        if (confirmResponse.ok) onPaymentSuccess(paymentIntent.id);\n        else {\n          const errData = await confirmResponse.json();\n          setError(errData.message || 'Không thể xác nhận thanh toán');\n        }\n      } else setError('Thanh toán không thành công');\n    } catch (err) {\n      console.error(err);\n      setError('Lỗi xử lý thanh toán');\n    }\n    setLoading(false);\n  };\n\n  const cardStyle = {\n    style: {\n      base: { fontSize: '16px', color: '#424770', '::placeholder': { color: '#aab7c4' } },\n      invalid: { color: '#fa755a', iconColor: '#fa755a' },\n    },\n  };\n\n  return (\n    <div className=\"payment-form\">\n      <h3>Tổng tiền: {new Intl.NumberFormat('vi-VN', { style: 'currency', currency }).format(amount)}</h3>\n      <p>Thanh toán an toàn với Stripe</p>\n\n      {error && <div className=\"error-message\">{error}</div>}\n\n      <form onSubmit={handleSubmit}>\n        {/* Tên chủ thẻ */}\n        <div className=\"form-group\">\n          <label>Tên chủ thẻ</label>\n          <input\n            type=\"text\"\n            placeholder=\"NGUYEN VAN A\"\n            value={name}\n            onChange={(e) => setName(e.target.value)}\n            required\n            disabled={loading}\n          />\n        </div>\n\n        {/* Fake card inputs */}\n        <div className=\"form-group-inline\">\n          <input\n            type=\"text\"\n            placeholder=\"Số thẻ 1234 5678 9012 3456\"\n            value={cardNumber}\n            onChange={(e) => setCardNumber(e.target.value)}\n            disabled={loading}\n          />\n          <input\n            type=\"text\"\n            placeholder=\"MM/YY\"\n            value={expiry}\n            onChange={(e) => setExpiry(e.target.value)}\n            disabled={loading}\n          />\n          <input\n            type=\"text\"\n            placeholder=\"CVC\"\n            value={cvc}\n            onChange={(e) => setCvc(e.target.value)}\n            disabled={loading}\n          />\n        </div>\n\n        {/* Stripe CardElement thực tế */}\n        <div className=\"form-group\">\n          <label>Thông tin thẻ</label>\n          <div className=\"card-element-container\">\n            {stripe && elements ? <CardElement options={cardStyle} /> : <div>Đang tải...</div>}\n          </div>\n        </div>\n\n        <button type=\"submit\" disabled={!stripe || !clientSecret || loading}>\n          {loading ? 'Đang xử lý...' : `Thanh toán ${new Intl.NumberFormat('vi-VN', { style: 'currency', currency }).format(amount)}`}\n        </button>\n      </form>\n\n      <p>🔒 Thanh toán được bảo mật bởi Stripe. Thông tin thẻ được mã hóa và bảo vệ.</p>\n    </div>\n  );\n};\n\n// Wallet Payment Form\nconst WalletPaymentForm = ({ amount, ticketId, onPaymentSuccess, onPaymentError }) => {\n  const [loading, setLoading] = useState(false);\n  const [pin, setPin] = useState('');\n  const [error, setError] = useState('');\n  const [requiresPin, setRequiresPin] = useState(false);\n\n  const handleSubmit = async (event) => {\n    event.preventDefault();\n\n    setLoading(true);\n    setError('');\n\n    try {\n      const token = localStorage.getItem('accessToken');\n\n      const response = await fetch('http://localhost:8080/api/v1/payments/create-payment-intent', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n        body: JSON.stringify({\n          ticketId,\n          amount,\n          currency: 'vnd',\n          paymentMethod: 'wallet',\n          pin: pin\n        }),\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        onPaymentSuccess(data.data?.transactionId || 'wallet-payment');\n      } else {\n        const errorData = await response.json();\n        if (errorData.statusCode === 400 && errorData.message.includes('PIN')) {\n          setRequiresPin(true);\n          setError(errorData.message);\n        } else {\n          setError(errorData.message || 'Thanh toán thất bại');\n        }\n      }\n    } catch (err) {\n      console.error(err);\n      setError('Lỗi kết nối server');\n    }\n\n    setLoading(false);\n  };\n\n  return (\n    <div className=\"payment-form wallet-payment\">\n      <h3>Tổng tiền: {new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount)}</h3>\n      <p>💡 Thanh toán nhanh chóng bằng ví điện tử</p>\n\n      {error && <div className=\"error-message\">{error}</div>}\n\n      <form onSubmit={handleSubmit}>\n        {requiresPin && (\n          <div className=\"form-group\">\n            <label>Nhập mã PIN ví điện tử</label>\n            <input\n              type=\"password\"\n              placeholder=\"1234\"\n              value={pin}\n              onChange={(e) => setPin(e.target.value.replace(/[^0-9]/g, '').slice(0, 6))}\n              maxLength={6}\n              required\n              disabled={loading}\n            />\n          </div>\n        )}\n\n        <button type=\"submit\" disabled={loading}>\n          {loading ? 'Đang xử lý...' : `💰 Thanh toán ${new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount)}`}\n        </button>\n      </form>\n\n      <p>⚡ Thanh toán ngay lập tức với ví điện tử của bạn</p>\n    </div>\n  );\n};\n\n// Main Payment Form Component\nconst PaymentForm = ({ amount, currency, ticketId, onPaymentSuccess, onPaymentError }) => {\n  const [selectedMethod, setSelectedMethod] = useState('stripe');\n  const [walletBalance, setWalletBalance] = useState(0);\n\n  useEffect(() => {\n    // Lấy thông tin ví điện tử\n    const fetchWalletInfo = async () => {\n      try {\n        const token = localStorage.getItem('accessToken');\n        const response = await fetch('http://localhost:8080/api/v1/wallet/balance', {\n          headers: {\n            'Authorization': `Bearer ${token}`,\n            'Content-Type': 'application/json'\n          }\n        });\n\n        if (response.ok) {\n          const data = await response.json();\n          setWalletBalance(data.data?.walletBalance || 0);\n\n          // Tự động chọn ví nếu có đủ số dư\n          if (data.data?.walletBalance >= amount) {\n            setSelectedMethod('wallet');\n          }\n        }\n      } catch (error) {\n        console.error('Lỗi lấy thông tin ví:', error);\n      }\n    };\n\n    fetchWalletInfo();\n  }, [amount]);\n\n  const renderPaymentForm = () => {\n    switch (selectedMethod) {\n      case 'wallet':\n        return (\n          <WalletPaymentForm\n            amount={amount}\n            ticketId={ticketId}\n            onPaymentSuccess={onPaymentSuccess}\n            onPaymentError={onPaymentError}\n          />\n        );\n      case 'stripe':\n      default:\n        return (\n          <Elements stripe={stripePromise}>\n            <StripePaymentForm\n              amount={amount}\n              currency={currency}\n              ticketId={ticketId}\n              onPaymentSuccess={onPaymentSuccess}\n              onPaymentError={onPaymentError}\n            />\n          </Elements>\n        );\n    }\n  };\n\n  return (\n    <div className=\"payment-form-container\">\n      <PaymentMethodSelector\n        selectedMethod={selectedMethod}\n        onMethodChange={setSelectedMethod}\n        walletBalance={walletBalance}\n        amount={amount}\n      />\n\n      <div className=\"payment-form-wrapper\">\n        {renderPaymentForm()}\n      </div>\n    </div>\n  );\n};\n\nexport default PaymentForm;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}